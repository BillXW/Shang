1                                        ;
2                                        ;       annotate version 1.03
3                                        ;
4                                        ; **************************************************
5                                        ; **************************************************
6                                                  section scale_factor_c
7                                                  opt     so,nomd
8                                                  page    132,66,3,3
9                                        ;*** DSP56000/1 Motorola 1.03 GNU 1.37.1
10        P:0000                                   org     p:
11        X:0000                                   org     x:
12                                       F___W0
13        X:0000                                   dc      4084
14        X:0001                                   dc      18
15        X:0002                                   dc      41
16        X:0003                                   dc      64
17        X:0004                                   dc      112
18        X:0005                                   dc      198
19        X:0006                                   dc      255
20        X:0007                                   dc      1122
21        P:0000                                   org     p:
22                                                 global  Fscale_factor
23                                       Fscale_factor
24                                       ; **************************************************
25                                       ; /* Global signals */
26                                       ; int A_2, AL, D, I, SD, S_E, SL, SP, TDP;
27                                       ; 
28                                       ; 
29                                       ; typedef struct
30                                       ; {
31                                       ;   int DQ, T, Y, YL, DQ2, DQ3, DQ4, DQ5, DQ6, DQ7, PK1, PK2, SR2,
32                                       ;       A1, A2, B[6], SE, SEZ, t_dr, LAST_TR, DMS, DML, AP, Y_L, LAST_Y;
33                                       ; } STATES;
34                                       ; 
35                                       ; 
36                                       ; void scale_factor(STATES* S)
37                                       ; {
38                                       ;   /*
39                                       ;    * scale factor adaptation
40                                       ;    *
41                                       ;    * Input signals:  AL, I
42                                       ;    * Output signals: YL, Y
43                                       ;    */
44                                       ; 
45                                       ;   static int W[] = 
46                                       ;   {
47                                       ;     4084, 18, 41, 64, 112, 198, 255, 1122
48                                       ;   } ; 
49                                       ;   register int TMP, YUP, YLP;
50                                       ;  
51                                       ;   /* FUNCTW */
52                                       ;   TMP = W[(I >> 3) ? (15 - I) & 7 : I & 7];
53                                       ; **************************************************
54        P:0000 70F400  [4 -        4]            move              #65533,n0
                 00FFFD
55        P:0002 3E0300  [2 -        6]            move              #3,n6
56        P:0003 605E00  [2 -        8]            move              r0,x:(r6)+
57        P:0004 205E00  [2 -       10]            move              (r6)+
58        P:0005 22D000  [2 -       12]            move              r6,r0
59        P:0006 204E00  [2 -       14]            move              (r6)+n6
60        P:0007 515E00  [2 -       16]            move              b0,x:(r6)+
61        P:0008 555E00  [2 -       18]            move              b1,x:(r6)+
62        P:0009 445E00  [2 -       20]            move              x0,x:(r6)+
63        P:000A 455E00  [2 -       22]            move              x1,x:(r6)+
64        P:000B 615E00  [2 -       24]            move              r1,x:(r6)+
65        P:000C 625E00  [2 -       26]            move              r2,x:(r6)+
66        P:000D 62E800  [4 -       30]            move              x:(r0+n0),r2
67        P:000E 380200  [2 -       32]            move              #2,n0
68        P:000F 45F000  [4 -       36]            move              x:FI,x1
                 00000D
69        P:0011 456861  [4 -       40]            tfr     x1,a      x1,x:(r0+n0)
70        P:0012 218E00  [2 -       42]            move              a1,a
71        P:0013 0603A0  [4 -       46]            rep     #3
72        P:0014 200022  [2 -       48]            asr     a
73        P:0015 218E00  [2 -       50]            move              a1,a
74        P:0016 200003  [2 -       52]            tst     a
75        P:0017 0AF0AA  [6 -       58]            jeq     L2
                 00001E
76        P:0019 56F400  [4 -       62]            move              #>15,a
                 00000F
77        P:001B 200064  [2 -       64]            sub     x1,a
78        P:001C 0AF080  [6 -       70]            jmp     L13
                 000020
79                                       L2
80        P:001E 56F000  [4 -       74]            move              x:FI,a
                 00000D
81                                       L13
82                                       ; **************************************************
83                                       ;   
84                                       ;   /* FILTD */
85                                       ;   TMP = ((TMP << 5) + 131072 - S->LAST_Y) & 131071;
86                                       ; **************************************************
87        P:0020 61F400  [4 -       78]            move              #F___W0,r1
                 000000
88        P:0022 44F400  [4 -       82]            move              #>7,x0
                 000007
89        P:0024 222F46  [2 -       84]            and     x0,a      r1,b
90        P:0025 218E00  [2 -       86]            move              a1,a
91        P:0026 200018  [2 -       88]            add     a,b
92        P:0027 21B100  [2 -       90]            move              b1,r1
93        P:0028 45E100  [2 -       92]            move              x:(r1),x1
94        P:0029 200069  [2 -       94]            tfr     x1,b
95        P:002A 0605A0  [4 -       98]            rep     #5
96        P:002B 20003A  [2 -      100]            asl     b
97                                       ; **************************************************
98                                       ;   TMP >>= 5;
99                                       ; **************************************************
100       P:002C 3A1D00  [2 -      102]            move              #29,n2
101       P:002D 44F400  [4 -      106]            move              #>16646144,x0
                 FE0000
102       P:002F 56EA00  [4 -      110]            move              x:(r2+n2),a
103       P:0030 21AF40  [2 -      112]            add     x0,a      b1,b
104       P:0031 44F41C  [4 -      116]            sub     a,b       #>131071,x0
                 01FFFF
105       P:0033 20004E  [2 -      118]            and     x0,b
106       P:0034 21AF00  [2 -      120]            move              b1,b
107       P:0035 21AF00  [2 -      122]            move              b1,b
108       P:0036 0605A0  [4 -      126]            rep     #5
109       P:0037 20002A  [2 -      128]            asr     b
110                                      ; **************************************************
111                                      ;   YUP = (TMP >> 11) ? TMP + 4096 : TMP;
112                                      ; **************************************************
113       P:0038 380200  [2 -      130]            move              #2,n0
114       P:0039 21AF00  [2 -      132]            move              b1,b
115       P:003A 556801  [4 -      136]            tfr     b,a       b1,x:(r0+n0)
116       P:003B 218E00  [2 -      138]            move              a1,a
117       P:003C 060BA0  [4 -      142]            rep     #11
118       P:003D 200022  [2 -      144]            asr     a
119       P:003E 218E00  [2 -      146]            move              a1,a
120       P:003F 200003  [2 -      148]            tst     a
121       P:0040 0AF0AA  [6 -      154]            jeq     L4
                 000048
122       P:0042 56F400  [4 -      158]            move              #>4096,a
                 001000
123       P:0044 200018  [2 -      160]            add     a,b
124       P:0045 556000  [2 -      162]            move              b1,x:(r0)
125       P:0046 0AF080  [6 -      168]            jmp     L5
                 00004B
126                                      L4
127       P:0048 380200  [2 -      170]            move              #2,n0
128       P:0049 45E800  [4 -      174]            move              x:(r0+n0),x1
129       P:004A 456000  [2 -      176]            move              x1,x:(r0)
130                                      L5
131                                      ; **************************************************
132                                      ;   YUP = (YUP + S->LAST_Y) & 8191;
133                                      ; **************************************************
134                                      ; **************************************************
135                                      ;   
136                                      ;   /* LIMB */
137                                      ;   if ((((YUP + 11264) & 16383) >> 13) == 0)
138                                      ; **************************************************
139       P:004B 3A1D00  [2 -      178]            move              #29,n2
140       P:004C 57E000  [2 -      180]            move              x:(r0),b
141       P:004D 56EA00  [4 -      184]            move              x:(r2+n2),a
142       P:004E 44F418  [4 -      188]            add     a,b       #>8191,x0
                 001FFF
143       P:0050 56F44E  [4 -      192]            and     x0,b      #>11264,a
                 002C00
144       P:0052 21AF00  [2 -      194]            move              b1,b
145       P:0053 44F400  [4 -      198]            move              #>16383,x0
                 003FFF
146       P:0055 556018  [2 -      200]            add     a,b       b1,x:(r0)
147       P:0056 200001  [2 -      202]            tfr     b,a
148       P:0057 200046  [2 -      204]            and     x0,a
149       P:0058 218E00  [2 -      206]            move              a1,a
150       P:0059 218E00  [2 -      208]            move              a1,a
151       P:005A 060DA0  [4 -      212]            rep     #13
152       P:005B 200022  [2 -      214]            asr     a
153       P:005C 218E00  [2 -      216]            move              a1,a
154       P:005D 200003  [2 -      218]            tst     a
155       P:005E 0AF0A2  [6 -      224]            jne     L6
                 000063
156                                      ; **************************************************
157                                      ;     YUP = 5120;
158                                      ; **************************************************
159       P:0060 45F400  [4 -      228]            move              #>5120,x1
                 001400
160       P:0062 456000  [2 -      230]            move              x1,x:(r0)
161                                      L6
162                                      ; **************************************************
163                                      ;   if ((((YUP + 15840) & 16383) >> 13))
164                                      ; **************************************************
165       P:0063 44F400  [4 -      234]            move              #>16383,x0
                 003FFF
166       P:0065 57E000  [2 -      236]            move              x:(r0),b
167       P:0066 56F400  [4 -      240]            move              #>15840,a
                 003DE0
168       P:0068 200018  [2 -      242]            add     a,b
169       P:0069 200001  [2 -      244]            tfr     b,a
170       P:006A 200046  [2 -      246]            and     x0,a
171       P:006B 218E00  [2 -      248]            move              a1,a
172       P:006C 218E00  [2 -      250]            move              a1,a
173       P:006D 060DA0  [4 -      254]            rep     #13
174       P:006E 200022  [2 -      256]            asr     a
175       P:006F 218E00  [2 -      258]            move              a1,a
176       P:0070 200003  [2 -      260]            tst     a
177       P:0071 0AF0AA  [6 -      266]            jeq     L7
                 000076
178                                      ; **************************************************
179                                      ;     YUP = 544;
180                                      ; **************************************************
181       P:0073 45F400  [4 -      270]            move              #>544,x1
                 000220
182       P:0075 456000  [2 -      272]            move              x1,x:(r0)
183                                      L7
184                                      ; **************************************************
185                                      ;   
186                                      ;   /* FILTE */
187                                      ;   TMP = (YUP + ((1048576 - S->Y_L) >> 6)) & 16383;
188                                      ; **************************************************
189       P:0076 3A1C00  [2 -      274]            move              #28,n2
190       P:0077 56F400  [4 -      278]            move              #>1048576,a
                 100000
191       P:0079 45EA00  [4 -      282]            move              x:(r2+n2),x1
192       P:007A 200064  [2 -      284]            sub     x1,a
193       P:007B 218E00  [2 -      286]            move              a1,a
194       P:007C 0606A0  [4 -      290]            rep     #6
195       P:007D 200022  [2 -      292]            asr     a
196                                      ; **************************************************
197                                      ;   if (TMP & (1 << 13))
198                                      ; **************************************************
199       P:007E 380200  [2 -      294]            move              #2,n0
200       P:007F 57E000  [2 -      296]            move              x:(r0),b
201       P:0080 44F400  [4 -      300]            move              #>16383,x0
                 003FFF
202       P:0082 218E00  [2 -      302]            move              a1,a
203       P:0083 200018  [2 -      304]            add     a,b
204       P:0084 44F44E  [4 -      308]            and     x0,b      #>8192,x0
                 002000
205       P:0086 21AF00  [2 -      310]            move              b1,b
206       P:0087 556801  [4 -      314]            tfr     b,a       b1,x:(r0+n0)
207       P:0088 200046  [2 -      316]            and     x0,a
208       P:0089 218E00  [2 -      318]            move              a1,a
209       P:008A 200003  [2 -      320]            tst     a
210       P:008B 0AF0AA  [6 -      326]            jeq     L8
                 000091
211                                      ; **************************************************
212                                      ;     TMP = TMP + 507904;
213                                      ; **************************************************
214       P:008D 56F400  [4 -      330]            move              #>507904,a
                 07C000
215       P:008F 200018  [2 -      332]            add     a,b
216       P:0090 556800  [4 -      336]            move              b1,x:(r0+n0)
217                                      L8
218                                      ; **************************************************
219                                      ;   YLP = (TMP + S->Y_L) & 524287;
220                                      ; **************************************************
221                                      ; **************************************************
222                                      ;   
223                                      ;   /* MIX */
224                                      ;   TMP = (YUP + 16384 - (S->Y_L >> 6)) & 16383;
225                                      ; **************************************************
226       P:0091 380200  [2 -      338]            move              #2,n0
227       P:0092 3A1C00  [2 -      340]            move              #28,n2
228       P:0093 57E800  [4 -      344]            move              x:(r0+n0),b
229       P:0094 56EA00  [4 -      348]            move              x:(r2+n2),a
230       P:0095 44F418  [4 -      352]            add     a,b       #>524287,x0
                 07FFFF
231       P:0097 218E4E  [2 -      354]            and     x0,b      a1,a
232       P:0098 21AF00  [2 -      356]            move              b1,b
233       P:0099 205800  [2 -      358]            move              (r0)+
234       P:009A 555000  [2 -      360]            move              b1,x:(r0)-
235       P:009B 0606A0  [4 -      364]            rep     #6
236       P:009C 200022  [2 -      366]            asr     a
237                                      ; **************************************************
238                                      ;   S->LAST_Y = TMP & (1 << 13) ? 1 : 0;
239                                      ; **************************************************
240       P:009D 57E000  [2 -      368]            move              x:(r0),b
241       P:009E 44F400  [4 -      372]            move              #>16383,x0
                 003FFF
242       P:00A0 45F400  [4 -      376]            move              #>16760832,x1
                 FFC000
243       P:00A2 218E00  [2 -      378]            move              a1,a
244       P:00A3 200060  [2 -      380]            add     x1,a
245       P:00A4 20001C  [2 -      382]            sub     a,b
246       P:00A5 44F44E  [4 -      386]            and     x0,b      #>8192,x0
                 002000
247       P:00A7 21AF00  [2 -      388]            move              b1,b
248       P:00A8 556801  [4 -      392]            tfr     b,a       b1,x:(r0+n0)
249       P:00A9 200046  [2 -      394]            and     x0,a
250       P:00AA 218E00  [2 -      396]            move              a1,a
251       P:00AB 200003  [2 -      398]            tst     a
252       P:00AC 0AF0AA  [6 -      404]            jeq     L9
                 0000B2
253       P:00AE 56F400  [4 -      408]            move              #>1,a
                 000001
254       P:00B0 0AF080  [6 -      414]            jmp     L10
                 0000B3
255                                      L9
256       P:00B2 200013  [2 -      416]            clr     a
257                                      L10
258                                      ; **************************************************
259                                      ;   if (S->LAST_Y)
260                                      ; **************************************************
261       P:00B3 3A1D03  [2 -      418]            tst     a         #29,n2
262       P:00B4 546A00  [4 -      422]            move              a1,x:(r2+n2)
263       P:00B5 0AF0AA  [6 -      428]            jeq     L11
                 0000C2
264                                      ; **************************************************
265                                      ;     TMP = (16384 - TMP) & 8191; 
266                                      ; **************************************************
267       P:00B7 380200  [2 -      430]            move              #2,n0
268       P:00B8 44F400  [4 -      434]            move              #>8191,x0
                 001FFF
269       P:00BA 45E800  [4 -      438]            move              x:(r0+n0),x1
270       P:00BB 56F400  [4 -      442]            move              #>16384,a
                 004000
271       P:00BD 200064  [2 -      444]            sub     x1,a
272       P:00BE 546809  [4 -      448]            tfr     a,b       a1,x:(r0+n0)
273       P:00BF 20004E  [2 -      450]            and     x0,b
274       P:00C0 21AF00  [2 -      452]            move              b1,b
275       P:00C1 556800  [4 -      456]            move              b1,x:(r0+n0)
276                                      L11
277                                      ; **************************************************
278                                      ;   TMP = (TMP * AL) >> 6;
279                                      ; **************************************************
280       P:00C2 380200  [2 -      458]            move              #2,n0
281       P:00C3 44F000  [4 -      462]            move              x:FAL,x0
                 00000F
282       P:00C5 45E800  [4 -      466]            move              x:(r0+n0),x1
283       P:00C6 2000A8  [2 -      468]            mpy     +x0,x1,b
284       P:00C7 20002A  [2 -      470]            asr     b
285       P:00C8 212F00  [2 -      472]            move              b0,b
286       P:00C9 21AF00  [2 -      474]            move              b1,b
287       P:00CA 0606A0  [4 -      478]            rep     #6
288       P:00CB 20002A  [2 -      480]            asr     b
289                                      ; **************************************************
290                                      ;   if (S->LAST_Y)
291                                      ; **************************************************
292       P:00CC 3A1D00  [2 -      482]            move              #29,n2
293       P:00CD 21AF00  [2 -      484]            move              b1,b
294       P:00CE 556800  [4 -      488]            move              b1,x:(r0+n0)
295       P:00CF 56EA00  [4 -      492]            move              x:(r2+n2),a
296       P:00D0 200003  [2 -      494]            tst     a
297       P:00D1 0AF0AA  [6 -      500]            jeq     L12
                 0000DD
298                                      ; **************************************************
299                                      ;     TMP = (16384 - TMP) & 16383;
300                                      ; **************************************************
301       P:00D3 45E800  [4 -      504]            move              x:(r0+n0),x1
302       P:00D4 44F400  [4 -      508]            move              #>16383,x0
                 003FFF
303       P:00D6 56F400  [4 -      512]            move              #>16384,a
                 004000
304       P:00D8 200064  [2 -      514]            sub     x1,a
305       P:00D9 546809  [4 -      518]            tfr     a,b       a1,x:(r0+n0)
306       P:00DA 20004E  [2 -      520]            and     x0,b
307       P:00DB 21AF00  [2 -      522]            move              b1,b
308       P:00DC 556800  [4 -      526]            move              b1,x:(r0+n0)
309                                      L12
310                                      ; **************************************************
311                                      ;   
312                                      ;   S->LAST_Y = S->Y = ((S->Y_L >> 6) + TMP) & 8191; 
313                                      ; **************************************************
314       P:00DD 3A1C00  [2 -      528]            move              #28,n2
315       P:00DE 56EA00  [4 -      532]            move              x:(r2+n2),a
316       P:00DF 218E00  [2 -      534]            move              a1,a
317       P:00E0 0606A0  [4 -      538]            rep     #6
318       P:00E1 200022  [2 -      540]            asr     a
319                                      ; **************************************************
320                                      ;   S->YL = S->Y_L; 
321                                      ; **************************************************
322                                      ; **************************************************
323                                      ;   S->Y_L = YLP;
324                                      ; **************************************************
325                                      ; **************************************************
326                                      ; }
327                                      ; **************************************************
328       P:00E2 3A0200  [2 -      542]            move              #2,n2
329       P:00E3 380200  [2 -      544]            move              #2,n0
330       P:00E4 44F400  [4 -      548]            move              #>8191,x0
                 001FFF
331       P:00E6 45E800  [4 -      552]            move              x:(r0+n0),x1
332       P:00E7 218E00  [2 -      554]            move              a1,a
333       P:00E8 205860  [2 -      556]            add     x1,a      (r0)+
334       P:00E9 205646  [2 -      558]            and     x0,a      (r6)-
335       P:00EA 218E00  [2 -      560]            move              a1,a
336       P:00EB 546A00  [4 -      564]            move              a1,x:(r2+n2)
337       P:00EC 3A1D00  [2 -      566]            move              #29,n2
338       P:00ED 546A00  [4 -      570]            move              a1,x:(r2+n2)
339       P:00EE 3A1C00  [2 -      572]            move              #28,n2
340       P:00EF 56EA00  [4 -      576]            move              x:(r2+n2),a
341       P:00F0 3A0300  [2 -      578]            move              #3,n2
342       P:00F1 546A00  [4 -      582]            move              a1,x:(r2+n2)
343       P:00F2 3A1C00  [2 -      584]            move              #28,n2
344       P:00F3 45D000  [2 -      586]            move              x:(r0)-,x1
345       P:00F4 456A00  [4 -      590]            move              x1,x:(r2+n2)
346       P:00F5 62D600  [2 -      592]            move              x:(r6)-,r2
347       P:00F6 61D600  [2 -      594]            move              x:(r6)-,r1
348       P:00F7 45D600  [2 -      596]            move              x:(r6)-,x1
349       P:00F8 44D600  [2 -      598]            move              x:(r6)-,x0
350       P:00F9 57D600  [2 -      600]            move              x:(r6)-,b
351       P:00FA 51E600  [2 -      602]            move              x:(r6),b0
352       P:00FB 205000  [2 -      604]            move              (r0)-
353       P:00FC 205000  [2 -      606]            move              (r0)-
354       P:00FD 221600  [2 -      608]            move              r0,r6
355       P:00FE 60E000  [2 -      610]            move              x:(r0),r0
356       P:00FF 00000C  [4 -      614]            rts
357    
358       X:0008                                   org     x:
359                                                global  FTDP
360       X:0008 000000                  FTDP      bsc     1
361                                                global  FSP
362       X:0009 000000                  FSP       bsc     1
363                                                global  FSL
364       X:000A 000000                  FSL       bsc     1
365                                                global  FS_E
366       X:000B 000000                  FS_E      bsc     1
367                                                global  FSD
368       X:000C 000000                  FSD       bsc     1
369                                                global  FI
370       X:000D 000000                  FI        bsc     1
371                                                global  FD
372       X:000E 000000                  FD        bsc     1
373                                                global  FAL
374       X:000F 000000                  FAL       bsc     1
375                                                global  FA_2
376       X:0010 000000                  FA_2      bsc     1
377    
378                                                endsec
379    
380    
7    Errors
0    Warnings
