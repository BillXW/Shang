1                                        ;
2                                        ;       annotate version 1.03
3                                        ;
4                                        ; **************************************************
5                                        ; **************************************************
6                                                  section speed_control_c
7                                                  opt     so,nomd
8                                                  page    132,66,3,3
9                                        ;*** DSP56000/1 Motorola 1.03 GNU 1.37.1
10        P:0000                                   org     p:
11        X:0000                                   org     x:
12                                       F___F0
13        X:0000                                   dc      0
14        X:0001                                   dc      0
15        X:0002                                   dc      0
16        X:0003                                   dc      1
17        X:0004                                   dc      1
18        X:0005                                   dc      1
19        X:0006                                   dc      3
20        X:0007                                   dc      7
21        P:0000                                   org     p:
22                                                 global  Fspeed_control
23                                       Fspeed_control
24                                       ; **************************************************
25                                       ; /* Global signals */
26                                       ; int A_2, AL, D, I, SD, S_E, SL, SP, TDP;
27                                       ; 
28                                       ; 
29                                       ; typedef struct
30                                       ; {
31                                       ;   int DQ, T, Y, YL, DQ2, DQ3, DQ4, DQ5, DQ6, DQ7, PK1, PK2, SR2,
32                                       ;       A1, A2, B[6], SE, SEZ, t_dr, LAST_TR, DMS, DML, AP, Y_L, LAST_Y;
33                                       ; } STATES;
34                                       ; 
35                                       ; 
36                                       ; void speed_control(STATES* S)
37                                       ; {
38                                       ;   /*
39                                       ;    * speed control
40                                       ;    *
41                                       ;    * Input signals:  T, TDP, I, Y
42                                       ;    * Output signals: AL
43                                       ;    */
44                                       ; 
45                                       ;   static int F[] = { 0, 0, 0, 1, 1, 1, 3, 7 };
46                                       ;   register int FI, tmp ; 
47                                       ; 
48                                       ;   /* FUNTCF */
49                                       ;   FI = F[(I >> 3 ? (15 - I) : I) & 7] ; 
50                                       ; **************************************************
51        P:0000 70F400  [4 -        4]            move              #65533,n0
                 00FFFD
52        P:0002 3E0300  [2 -        6]            move              #3,n6
53        P:0003 605E00  [2 -        8]            move              r0,x:(r6)+
54        P:0004 205E00  [2 -       10]            move              (r6)+
55        P:0005 22D000  [2 -       12]            move              r6,r0
56        P:0006 204E00  [2 -       14]            move              (r6)+n6
57        P:0007 515E00  [2 -       16]            move              b0,x:(r6)+
58        P:0008 555E00  [2 -       18]            move              b1,x:(r6)+
59        P:0009 445E00  [2 -       20]            move              x0,x:(r6)+
60        P:000A 455E00  [2 -       22]            move              x1,x:(r6)+
61        P:000B 465E00  [2 -       24]            move              y0,x:(r6)+
62        P:000C 615E00  [2 -       26]            move              r1,x:(r6)+
63        P:000D 625E00  [2 -       28]            move              r2,x:(r6)+
64        P:000E 62E800  [4 -       32]            move              x:(r0+n0),r2
65        P:000F 380200  [2 -       34]            move              #2,n0
66        P:0010 46F000  [4 -       38]            move              x:FI,y0
                 00000D
67        P:0012 466851  [4 -       42]            tfr     y0,a      y0,x:(r0+n0)
68        P:0013 218E00  [2 -       44]            move              a1,a
69        P:0014 0603A0  [4 -       48]            rep     #3
70        P:0015 200022  [2 -       50]            asr     a
71        P:0016 218E00  [2 -       52]            move              a1,a
72        P:0017 200003  [2 -       54]            tst     a
73        P:0018 0AF0AA  [6 -       60]            jeq     L2
                 00001F
74        P:001A 56F400  [4 -       64]            move              #>15,a
                 00000F
75        P:001C 200054  [2 -       66]            sub     y0,a
76        P:001D 0AF080  [6 -       72]            jmp     L3
                 000021
77                                       L2
78        P:001F 56F000  [4 -       76]            move              x:FI,a
                 00000D
79                                       L3
80                                       ; **************************************************
81                                       ; 
82                                       ;   /* FILTA */
83                                       ;   tmp = ((FI << 9) + 8192 - S->DMS) & 8191;              /* tmp => DIF */
84                                       ; **************************************************
85        P:0021 61F400  [4 -       80]            move              #F___F0,r1
                 000000
86        P:0023 44F400  [4 -       84]            move              #>7,x0
                 000007
87        P:0025 222F46  [2 -       86]            and     x0,a      r1,b
88        P:0026 218E00  [2 -       88]            move              a1,a
89        P:0027 200018  [2 -       90]            add     a,b
90        P:0028 21B100  [2 -       92]            move              b1,r1
91        P:0029 46E100  [2 -       94]            move              x:(r1),y0
92        P:002A 466059  [2 -       96]            tfr     y0,b      y0,x:(r0)
93        P:002B 0609A0  [4 -      100]            rep     #9
94        P:002C 20003A  [2 -      102]            asl     b
95                                       ; **************************************************
96                                       ;   tmp >>= 5;
97                                       ; **************************************************
98        P:002D 3A1900  [2 -      104]            move              #25,n2
99        P:002E 44F400  [4 -      108]            move              #>16769024,x0
                 FFE000
100       P:0030 56EA00  [4 -      112]            move              x:(r2+n2),a
101       P:0031 21AF40  [2 -      114]            add     x0,a      b1,b
102       P:0032 44F41C  [4 -      118]            sub     a,b       #>8191,x0
                 001FFF
103       P:0034 20004E  [2 -      120]            and     x0,b
104       P:0035 21AF00  [2 -      122]            move              b1,b
105       P:0036 21AF00  [2 -      124]            move              b1,b
106       P:0037 0605A0  [4 -      128]            rep     #5
107       P:0038 20002A  [2 -      130]            asr     b
108                                      ; **************************************************
109                                      ;   if (tmp & (1 << 7))
110                                      ; **************************************************
111       P:0039 44F400  [4 -      134]            move              #>128,x0
                 000080
112       P:003B 21AF00  [2 -      136]            move              b1,b
113       P:003C 205801  [2 -      138]            tfr     b,a       (r0)+
114       P:003D 555046  [2 -      140]            and     x0,a      b1,x:(r0)-
115       P:003E 218E00  [2 -      142]            move              a1,a
116       P:003F 200003  [2 -      144]            tst     a
117       P:0040 0AF0AA  [6 -      150]            jeq     L4
                 000046
118                                      ; **************************************************
119                                      ;     tmp = tmp + 3840;                                    /* tmp => DIFSX */
120                                      ; **************************************************
121       P:0042 56F400  [4 -      154]            move              #>3840,a
                 000F00
122       P:0044 205818  [2 -      156]            add     a,b       (r0)+
123       P:0045 555000  [2 -      158]            move              b1,x:(r0)-
124                                      L4
125                                      ; **************************************************
126                                      ;   S->DMS = (tmp + S->DMS) & 4095;
127                                      ; **************************************************
128                                      ; **************************************************
129                                      ; 
130                                      ;   /* FILTB */
131                                      ;   tmp = ((FI << 11) + 32768 - S->DML) & 32767;           /* tmp => DIF */
132                                      ; **************************************************
133       P:0046 3A1900  [2 -      160]            move              #25,n2
134       P:0047 44F400  [4 -      164]            move              #>4095,x0
                 000FFF
135       P:0049 56EA00  [4 -      168]            move              x:(r2+n2),a
136       P:004A 205800  [2 -      170]            move              (r0)+
137       P:004B 57D000  [2 -      172]            move              x:(r0)-,b
138       P:004C 200018  [2 -      174]            add     a,b
139       P:004D 200001  [2 -      176]            tfr     b,a
140       P:004E 200046  [2 -      178]            and     x0,a
141       P:004F 218E00  [2 -      180]            move              a1,a
142       P:0050 546A00  [4 -      184]            move              a1,x:(r2+n2)
143       P:0051 57E000  [2 -      186]            move              x:(r0),b
144       P:0052 060BA0  [4 -      190]            rep     #11
145       P:0053 20003A  [2 -      192]            asl     b
146                                      ; **************************************************
147                                      ;   tmp >>= 7;
148                                      ; **************************************************
149       P:0054 3A1A00  [2 -      194]            move              #26,n2
150       P:0055 44F400  [4 -      198]            move              #>16744448,x0
                 FF8000
151       P:0057 56EA00  [4 -      202]            move              x:(r2+n2),a
152       P:0058 21AF40  [2 -      204]            add     x0,a      b1,b
153       P:0059 44F41C  [4 -      208]            sub     a,b       #>32767,x0
                 007FFF
154       P:005B 20004E  [2 -      210]            and     x0,b
155       P:005C 21AF00  [2 -      212]            move              b1,b
156       P:005D 21AF00  [2 -      214]            move              b1,b
157       P:005E 0607A0  [4 -      218]            rep     #7
158       P:005F 20002A  [2 -      220]            asr     b
159                                      ; **************************************************
160                                      ;   if (tmp & (1 << 7))
161                                      ; **************************************************
162       P:0060 44F400  [4 -      224]            move              #>128,x0
                 000080
163       P:0062 21AF00  [2 -      226]            move              b1,b
164       P:0063 205801  [2 -      228]            tfr     b,a       (r0)+
165       P:0064 555046  [2 -      230]            and     x0,a      b1,x:(r0)-
166       P:0065 218E00  [2 -      232]            move              a1,a
167       P:0066 200003  [2 -      234]            tst     a
168       P:0067 0AF0AA  [6 -      240]            jeq     L5
                 00006D
169                                      ; **************************************************
170                                      ;     tmp = tmp + 16128;                                   /* tmp => DIFSX */
171                                      ; **************************************************
172       P:0069 56F400  [4 -      244]            move              #>16128,a
                 003F00
173       P:006B 205818  [2 -      246]            add     a,b       (r0)+
174       P:006C 555000  [2 -      248]            move              b1,x:(r0)-
175                                      L5
176                                      ; **************************************************
177                                      ;   S->DML = (tmp + S->DML) & 16383;
178                                      ; **************************************************
179                                      ; **************************************************
180                                      ; 
181                                      ;   /* SUBTC */
182                                      ;   tmp = ((S->DMS << 2) + 32768 - S->DML) & 32767;        /* tmp => DIF */
183                                      ; **************************************************
184                                      ; **************************************************
185                                      ;   if (tmp & (1 << 14))
186                                      ; **************************************************
187       P:006D 380200  [2 -      250]            move              #2,n0
188       P:006E 3A1A00  [2 -      252]            move              #26,n2
189       P:006F 44F400  [4 -      256]            move              #>16744448,x0
                 FF8000
190       P:0071 56EA00  [4 -      260]            move              x:(r2+n2),a
191       P:0072 45F400  [4 -      264]            move              #>16383,x1
                 003FFF
192       P:0074 205800  [2 -      266]            move              (r0)+
193       P:0075 57D000  [2 -      268]            move              x:(r0)-,b
194       P:0076 200018  [2 -      270]            add     a,b
195       P:0077 200001  [2 -      272]            tfr     b,a
196       P:0078 200066  [2 -      274]            and     x1,a
197       P:0079 218E00  [2 -      276]            move              a1,a
198       P:007A 546A40  [4 -      280]            add     x0,a      a1,x:(r2+n2)
199       P:007B 3A1900  [2 -      282]            move              #25,n2
200       P:007C 44F400  [4 -      286]            move              #>32767,x0
                 007FFF
201       P:007E 46EA00  [4 -      290]            move              x:(r2+n2),y0
202       P:007F 466859  [4 -      294]            tfr     y0,b      y0,x:(r0+n0)
203       P:0080 20583A  [2 -      296]            asl     b         (r0)+
204       P:0081 20003A  [2 -      298]            asl     b
205       P:0082 21AF00  [2 -      300]            move              b1,b
206       P:0083 20001C  [2 -      302]            sub     a,b
207       P:0084 44F44E  [4 -      306]            and     x0,b      #>16384,x0
                 004000
208       P:0086 21AF00  [2 -      308]            move              b1,b
209       P:0087 555001  [2 -      310]            tfr     b,a       b1,x:(r0)-
210       P:0088 200046  [2 -      312]            and     x0,a
211       P:0089 218E00  [2 -      314]            move              a1,a
212       P:008A 200003  [2 -      316]            tst     a
213       P:008B 0AF0AA  [6 -      322]            jeq     L6
                 000096
214                                      ; **************************************************
215                                      ;     tmp = (32768 - tmp) & 16383;                         /* tmp => DIFM */
216                                      ; **************************************************
217       P:008D 56F400  [4 -      326]            move              #>32768,a
                 008000
218       P:008F 205800  [2 -      328]            move              (r0)+
219       P:0090 46D000  [2 -      330]            move              x:(r0)-,y0
220       P:0091 205854  [2 -      332]            sub     y0,a      (r0)+
221       P:0092 545009  [2 -      334]            tfr     a,b       a1,x:(r0)-
222       P:0093 20586E  [2 -      336]            and     x1,b      (r0)+
223       P:0094 21AF00  [2 -      338]            move              b1,b
224       P:0095 555000  [2 -      340]            move              b1,x:(r0)-
225                                      L6
226                                      ; **************************************************
227                                      ;   FI = ((S->Y > 1535) && (tmp < (S->DML >> 3)) && (TDP == 0)) ? 0 : 1;
228                                      ; **************************************************
229       P:0096 3A0200  [2 -      342]            move              #2,n2
230       P:0097 57F400  [4 -      346]            move              #>1535,b
                 0005FF
231       P:0099 56EA00  [4 -      350]            move              x:(r2+n2),a
232       P:009A 200005  [2 -      352]            cmp     b,a
233       P:009B 0AF0AF  [6 -      358]            jle     L7
                 0000B0
234       P:009D 3A1A00  [2 -      360]            move              #26,n2
235       P:009E 56EA00  [4 -      364]            move              x:(r2+n2),a
236       P:009F 218E00  [2 -      366]            move              a1,a
237       P:00A0 0603A0  [4 -      370]            rep     #3
238       P:00A1 200022  [2 -      372]            asr     a
239       P:00A2 218E00  [2 -      374]            move              a1,a
240       P:00A3 205800  [2 -      376]            move              (r0)+
241       P:00A4 57D000  [2 -      378]            move              x:(r0)-,b
242       P:00A5 20000D  [2 -      380]            cmp     a,b
243       P:00A6 0AF0A1  [6 -      386]            jge     L7
                 0000B0
244       P:00A8 56F000  [4 -      390]            move              x:FTDP,a
                 000008
245       P:00AA 200003  [2 -      392]            tst     a
246       P:00AB 0AF0A2  [6 -      398]            jne     L7
                 0000B0
247       P:00AD 260000  [2 -      400]            move              #0,y0
248       P:00AE 0AF080  [6 -      406]            jmp     L14
                 0000B2
249                                      L7
250       P:00B0 46F400  [4 -      410]            move              #>1,y0
                 000001
251                                      L14
252                                      ; **************************************************
253                                      ; 
254                                      ;   /* FILTC */
255                                      ;   tmp = ((FI << 9) + 2048 - S->AP) & 2047;               /* tmp => DIF */ 
256                                      ; **************************************************
257       P:00B2 466000  [2 -      412]            move              y0,x:(r0)
258       P:00B3 57E000  [2 -      414]            move              x:(r0),b
259       P:00B4 0609A0  [4 -      418]            rep     #9
260       P:00B5 20003A  [2 -      420]            asl     b
261                                      ; **************************************************
262                                      ;   tmp = (tmp >> 4) + (tmp >> 10 ? 896 : 0);              /* tmp => DIFSX */
263                                      ; **************************************************
264       P:00B6 3A1B00  [2 -      422]            move              #27,n2
265       P:00B7 44F400  [4 -      426]            move              #>16775168,x0
                 FFF800
266       P:00B9 56EA00  [4 -      430]            move              x:(r2+n2),a
267       P:00BA 21AF40  [2 -      432]            add     x0,a      b1,b
268       P:00BB 44F41C  [4 -      436]            sub     a,b       #>2047,x0
                 0007FF
269       P:00BD 20584E  [2 -      438]            and     x0,b      (r0)+
270       P:00BE 21AF00  [2 -      440]            move              b1,b
271       P:00BF 555001  [2 -      442]            tfr     b,a       b1,x:(r0)-
272       P:00C0 21AF00  [2 -      444]            move              b1,b
273       P:00C1 0604A0  [4 -      448]            rep     #4
274       P:00C2 20002A  [2 -      450]            asr     b
275       P:00C3 380200  [2 -      452]            move              #2,n0
276       P:00C4 218E00  [2 -      454]            move              a1,a
277       P:00C5 21AF00  [2 -      456]            move              b1,b
278       P:00C6 556800  [4 -      460]            move              b1,x:(r0+n0)
279       P:00C7 060AA0  [4 -      464]            rep     #10
280       P:00C8 200022  [2 -      466]            asr     a
281       P:00C9 218E00  [2 -      468]            move              a1,a
282       P:00CA 200003  [2 -      470]            tst     a
283       P:00CB 0AF0AA  [6 -      476]            jeq     L9
                 0000D1
284       P:00CD 56F400  [4 -      480]            move              #>896,a
                 000380
285       P:00CF 200018  [2 -      482]            add     a,b
286       P:00D0 556800  [4 -      486]            move              b1,x:(r0+n0)
287                                      L9
288                                      ; **************************************************
289                                      ;   tmp = (tmp + S->AP) & 1023;                            /* tmp => APP */
290                                      ; **************************************************
291                                      ; **************************************************
292                                      ; 
293                                      ;   /* TRIGA */
294                                      ;   S->AP = S->T ? 256 : tmp; 
295                                      ; **************************************************
296       P:00D1 3A1B00  [2 -      488]            move              #27,n2
297       P:00D2 380200  [2 -      490]            move              #2,n0
298       P:00D3 56EA00  [4 -      494]            move              x:(r2+n2),a
299       P:00D4 46E800  [4 -      498]            move              x:(r0+n0),y0
300       P:00D5 44F459  [4 -      502]            tfr     y0,b      #>1023,x0
                 0003FF
301       P:00D7 205818  [2 -      504]            add     a,b       (r0)+
302       P:00D8 205A4E  [2 -      506]            and     x0,b      (r2)+
303       P:00D9 21AF00  [2 -      508]            move              b1,b
304       P:00DA 555000  [2 -      510]            move              b1,x:(r0)-
305       P:00DB 56D200  [2 -      512]            move              x:(r2)-,a
306       P:00DC 200003  [2 -      514]            tst     a
307       P:00DD 0AF0AA  [6 -      520]            jeq     L10
                 0000E3
308       P:00DF 46F400  [4 -      524]            move              #>256,y0
                 000100
309       P:00E1 0AF080  [6 -      530]            jmp     L15
                 0000E5
310                                      L10
311       P:00E3 205800  [2 -      532]            move              (r0)+
312       P:00E4 46D000  [2 -      534]            move              x:(r0)-,y0
313                                      L15
314                                      ; **************************************************
315                                      ; 
316                                      ;   /* LIMA */
317                                      ;   AL = (S->AP > 255) ? 64 : S->AP >> 2; 
318                                      ; **************************************************
319       P:00E5 3A1B00  [2 -      536]            move              #27,n2
320       P:00E6 380200  [2 -      538]            move              #2,n0
321       P:00E7 56F400  [4 -      542]            move              #>255,a
                 0000FF
322       P:00E9 466800  [4 -      546]            move              y0,x:(r0+n0)
323       P:00EA 46E800  [4 -      550]            move              x:(r0+n0),y0
324       P:00EB 466A59  [4 -      554]            tfr     y0,b      y0,x:(r2+n2)
325       P:00EC 20000D  [2 -      556]            cmp     a,b
326       P:00ED 0AF0AF  [6 -      562]            jle     L12
                 0000F3
327       P:00EF 56F400  [4 -      566]            move              #>64,a
                 000040
328       P:00F1 0AF080  [6 -      572]            jmp     L13
                 0000F9
329                                      L12
330       P:00F3 3A1B00  [2 -      574]            move              #27,n2
331       P:00F4 56EA00  [4 -      578]            move              x:(r2+n2),a
332       P:00F5 218E00  [2 -      580]            move              a1,a
333       P:00F6 200022  [2 -      582]            asr     a
334       P:00F7 200022  [2 -      584]            asr     a
335       P:00F8 218E00  [2 -      586]            move              a1,a
336                                      L13
337                                      ; **************************************************
338                                      ; }
339                                      ; **************************************************
340       P:00F9 205000  [2 -      588]            move              (r0)-
341       P:00FA 205000  [2 -      590]            move              (r0)-
342       P:00FB 205600  [2 -      592]            move              (r6)-
343       P:00FC 547000  [4 -      596]            move              a1,x:FAL
                 00000F
344       P:00FE 62D600  [2 -      598]            move              x:(r6)-,r2
345       P:00FF 61D600  [2 -      600]            move              x:(r6)-,r1
346       P:0100 46D600  [2 -      602]            move              x:(r6)-,y0
347       P:0101 45D600  [2 -      604]            move              x:(r6)-,x1
348       P:0102 44D600  [2 -      606]            move              x:(r6)-,x0
349       P:0103 57D600  [2 -      608]            move              x:(r6)-,b
350       P:0104 51E600  [2 -      610]            move              x:(r6),b0
351       P:0105 221600  [2 -      612]            move              r0,r6
352       P:0106 60E000  [2 -      614]            move              x:(r0),r0
353       P:0107 00000C  [4 -      618]            rts
354    
355       X:0008                                   org     x:
356                                                global  FTDP
357       X:0008 000000                  FTDP      bsc     1
358                                                global  FSP
359       X:0009 000000                  FSP       bsc     1
360                                                global  FSL
361       X:000A 000000                  FSL       bsc     1
362                                                global  FS_E
363       X:000B 000000                  FS_E      bsc     1
364                                                global  FSD
365       X:000C 000000                  FSD       bsc     1
366                                                global  FI
367       X:000D 000000                  FI        bsc     1
368                                                global  FD
369       X:000E 000000                  FD        bsc     1
370                                                global  FAL
371       X:000F 000000                  FAL       bsc     1
372                                                global  FA_2
373       X:0010 000000                  FA_2      bsc     1
374    
375                                                endsec
376    
377    
3    Errors
0    Warnings
