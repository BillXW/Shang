1                                        ;
2                                        ;       annotate version 1.03
3                                        ;
4                                        ; **************************************************
5                                        ; **************************************************
6                                                  section fmult_c
7                                                  opt     so,nomd
8                                                  page    132,66,3,3
9                                        ;*** DSP56000/1 Motorola 1.03 GNU 1.37.1
10        P:0000                                   org     p:
11                                                 global  Ff_mult
12                                       Ff_mult
13                                       ; **************************************************
14                                       ; 
15                                       ; #define LSHIFT(a, b) ((b) < 0 ? (a) << -(b) : (a) >> (b))
16                                       ; #define SIGNBIT(a, b) ((a) & (1 << (b)) ? 1 : 0)
17                                       ;  
18                                       ; int f_mult(int An, int SRn)
19                                       ; {
20                                       ;   register int  EXP;
21                                       ;   register int  WAnMANT;
22                                       ;   int           AnS, MAG, AnMANT;
23                                       ; 
24                                       ;   AnS = SIGNBIT(An, 15);
25                                       ; **************************************************
26        P:0000 70F400  [4 -        4]            move              #65533,n0
                 00FFFD
27        P:0002 3E0300  [2 -        6]            move              #3,n6
28        P:0003 605E00  [2 -        8]            move              r0,x:(r6)+
29        P:0004 205E00  [2 -       10]            move              (r6)+
30        P:0005 22D000  [2 -       12]            move              r6,r0
31        P:0006 204E00  [2 -       14]            move              (r6)+n6
32        P:0007 515E00  [2 -       16]            move              b0,x:(r6)+
33        P:0008 555E00  [2 -       18]            move              b1,x:(r6)+
34        P:0009 445E00  [2 -       20]            move              x0,x:(r6)+
35        P:000A 44F400  [4 -       24]            move              #>32768,x0
                 008000
36        P:000C 455E00  [2 -       26]            move              x1,x:(r6)+
37        P:000D 465E00  [2 -       28]            move              y0,x:(r6)+
38        P:000E 475E00  [2 -       30]            move              y1,x:(r6)+
39        P:000F 56E800  [4 -       34]            move              x:(r0+n0),a
40        P:0010 200046  [2 -       36]            and     x0,a
41        P:0011 218E00  [2 -       38]            move              a1,a
42        P:0012 200003  [2 -       40]            tst     a
43        P:0013 0AF0AA  [6 -       46]            jeq     L2
                 000019
44        P:0015 46F400  [4 -       50]            move              #>1,y0
                 000001
45        P:0017 0AF080  [6 -       56]            jmp     L14
                 00001A
46                                       L2
47        P:0019 260000  [2 -       58]            move              #0,y0
48                                       L14
49                                       ; **************************************************
50                                       ;   MAG = AnS? (16384 - (An >> 2)) & 8191 : An >> 2;
51                                       ; **************************************************
52        P:001A 380200  [2 -       60]            move              #2,n0
53        P:001B 466800  [4 -       64]            move              y0,x:(r0+n0)
54        P:001C 57E800  [4 -       68]            move              x:(r0+n0),b
55        P:001D 20000B  [2 -       70]            tst     b
56        P:001E 0AF0AA  [6 -       76]            jeq     L4
                 00002F
57        P:0020 70F400  [4 -       80]            move              #65533,n0
                 00FFFD
58        P:0022 44F400  [4 -       84]            move              #>8191,x0
                 001FFF
59        P:0024 56E800  [4 -       88]            move              x:(r0+n0),a
60        P:0025 218E00  [2 -       90]            move              a1,a
61        P:0026 57F422  [4 -       94]            asr     a         #>16384,b
                 004000
62        P:0028 200022  [2 -       96]            asr     a
63        P:0029 218E00  [2 -       98]            move              a1,a
64        P:002A 20001C  [2 -      100]            sub     a,b
65        P:002B 20004E  [2 -      102]            and     x0,b
66        P:002C 21AF00  [2 -      104]            move              b1,b
67        P:002D 0AF080  [6 -      110]            jmp     L15
                 000036
68                                       L4
69        P:002F 70F400  [4 -      114]            move              #65533,n0
                 00FFFD
70        P:0031 57E800  [4 -      118]            move              x:(r0+n0),b
71        P:0032 21AF00  [2 -      120]            move              b1,b
72        P:0033 20002A  [2 -      122]            asr     b
73        P:0034 20002A  [2 -      124]            asr     b
74        P:0035 21AF00  [2 -      126]            move              b1,b
75                                       L15
76                                       ; **************************************************
77                                       ; /*  {
78                                       ;     register int mag = MAG << 1;
79                                       ;  
80                                       ;     for (EXP = 0; mag >>= 1; EXP++)
81                                       ;         ;
82                                       ;   } */
83                                       ; 
84                                       ;   AnMANT = MAG ? LSHIFT(MAG, EXP - 6) : 1 << 5;
85                                       ; **************************************************
86        P:0036 205800  [2 -      128]            move              (r0)+
87        P:0037 555000  [2 -      130]            move              b1,x:(r0)-
88        P:0038 205800  [2 -      132]            move              (r0)+
89        P:0039 57D000  [2 -      134]            move              x:(r0)-,b
90        P:003A 20000B  [2 -      136]            tst     b
91        P:003B 0AF0AA  [6 -      142]            jeq     L6
                 00005C
92        P:003D 56F469  [4 -      146]            tfr     x1,b      #>16777210,a
                 FFFFFA
93        P:003F 200018  [2 -      148]            add     a,b
94        P:0040 200001  [2 -      150]            tfr     b,a
95        P:0041 200003  [2 -      152]            tst     a
96        P:0042 0AF0A1  [6 -      158]            jge     L8
                 00004E
97        P:0044 205836  [2 -      160]            neg     a         (r0)+
98        P:0045 57D003  [2 -      162]            tst     a         x:(r0)-,b
99        P:0046 0AF0AA  [6 -      168]            jeq     L17
                 00004B
100       P:0048 06CE20  [4 -      172]            rep     a
101       P:0049 20003A  [2 -      174]            asl     b
102       P:004A 21AF00  [2 -      176]            move              b1,b
103                                      L17
104       P:004B 556000  [2 -      178]            move              b1,x:(r0)
105       P:004C 0AF080  [6 -      184]            jmp     L7
                 00005F
106                                      L8
107       P:004E 56F469  [4 -      188]            tfr     x1,b      #>16777210,a
                 FFFFFA
108       P:0050 205818  [2 -      190]            add     a,b       (r0)+
109       P:0051 57D001  [2 -      192]            tfr     b,a       x:(r0)-,b
110       P:0052 200003  [2 -      194]            tst     a
111       P:0053 0AF0AA  [6 -      200]            jeq     L18
                 000059
112       P:0055 21AF00  [2 -      202]            move              b1,b
113       P:0056 06CE20  [4 -      206]            rep     a
114       P:0057 20002A  [2 -      208]            asr     b
115       P:0058 21AF00  [2 -      210]            move              b1,b
116                                      L18
117       P:0059 556000  [2 -      212]            move              b1,x:(r0)
118       P:005A 0AF080  [6 -      218]            jmp     L7
                 00005F
119                                      L6
120       P:005C 46F400  [4 -      222]            move              #>32,y0
                 000020
121       P:005E 466000  [2 -      224]            move              y0,x:(r0)
122                                      L7
123                                      ; **************************************************
124                                      ;   EXP += ((SRn >> 6) & 15);
125                                      ; **************************************************
126       P:005F 70F400  [4 -      228]            move              #65532,n0
                 00FFFC
127       P:0061 56E800  [4 -      232]            move              x:(r0+n0),a
128       P:0062 218E00  [2 -      234]            move              a1,a
129       P:0063 0606A0  [4 -      238]            rep     #6
130       P:0064 200022  [2 -      240]            asr     a
131                                      ; **************************************************
132                                      ;   WAnMANT = (((SRn & 63) * AnMANT) + 48) >> 4;
133                                      ; **************************************************
134       P:0065 46E069  [2 -      242]            tfr     x1,b      x:(r0),y0
135       P:0066 44F400  [4 -      246]            move              #>15,x0
                 00000F
136       P:0068 218E00  [2 -      248]            move              a1,a
137       P:0069 44F446  [4 -      252]            and     x0,a      #>63,x0
                 00003F
138       P:006B 218E00  [2 -      254]            move              a1,a
139       P:006C 56F418  [4 -      258]            add     a,b       #>48,a
                 000030
140       P:006E 21C800  [2 -      260]            move              a,a0
141       P:006F 21A532  [2 -      262]            asl     a         b1,x1
142       P:0070 57E800  [4 -      266]            move              x:(r0+n0),b
143       P:0071 20004E  [2 -      268]            and     x0,b
144       P:0072 21AF00  [2 -      270]            move              b1,b
145       P:0073 21A700  [2 -      272]            move              b1,y1
146       P:0074 2000B2  [2 -      274]            mac     +y1,y0,a
147       P:0075 200022  [2 -      276]            asr     a
148       P:0076 210E00  [2 -      278]            move              a0,a
149       P:0077 200009  [2 -      280]            tfr     a,b
150       P:0078 21AF00  [2 -      282]            move              b1,b
151       P:0079 0604A0  [4 -      286]            rep     #4
152       P:007A 20002A  [2 -      288]            asr     b
153                                      ; **************************************************
154                                      ;   MAG = LSHIFT(WAnMANT, 19 - EXP) & 32767;
155                                      ; **************************************************
156       P:007B 56F400  [4 -      292]            move              #>19,a
                 000013
157       P:007D 21AF64  [2 -      294]            sub     x1,a      b1,b
158       P:007E 205803  [2 -      296]            tst     a         (r0)+
159       P:007F 555000  [2 -      298]            move              b1,x:(r0)-
160       P:0080 0AF0A1  [6 -      304]            jge     L10
                 00008B
161       P:0082 200036  [2 -      306]            neg     a
162       P:0083 200003  [2 -      308]            tst     a
163       P:0084 0AF0AA  [6 -      314]            jeq     L19
                 000089
164       P:0086 06CE20  [4 -      318]            rep     a
165       P:0087 20003A  [2 -      320]            asl     b
166       P:0088 21AF00  [2 -      322]            move              b1,b
167                                      L19
168       P:0089 0AF080  [6 -      328]            jmp     L16
                 000095
169                                      L10
170       P:008B 56F400  [4 -      332]            move              #>19,a
                 000013
171       P:008D 205864  [2 -      334]            sub     x1,a      (r0)+
172       P:008E 57D003  [2 -      336]            tst     a         x:(r0)-,b
173       P:008F 0AF0AA  [6 -      342]            jeq     L20
                 000095
174       P:0091 21AF00  [2 -      344]            move              b1,b
175       P:0092 06CE20  [4 -      348]            rep     a
176       P:0093 20002A  [2 -      350]            asr     b
177       P:0094 21AF00  [2 -      352]            move              b1,b
178                                      L20
179                                      L16
180                                      ; **************************************************
181                                      ;   return ((SRn >> 10) ^ AnS ? (65536 - MAG) & 65535 : MAG);
182                                      ; **************************************************
183       P:0095 70F400  [4 -      356]            move              #65532,n0
                 00FFFC
184       P:0097 44F400  [4 -      360]            move              #>32767,x0
                 007FFF
185       P:0099 205800  [2 -      362]            move              (r0)+
186       P:009A 555000  [2 -      364]            move              b1,x:(r0)-
187       P:009B 205800  [2 -      366]            move              (r0)+
188       P:009C 57D000  [2 -      368]            move              x:(r0)-,b
189       P:009D 20584E  [2 -      370]            and     x0,b      (r0)+
190       P:009E 21AF00  [2 -      372]            move              b1,b
191       P:009F 555000  [2 -      374]            move              b1,x:(r0)-
192       P:00A0 56E800  [4 -      378]            move              x:(r0+n0),a
193       P:00A1 218E00  [2 -      380]            move              a1,a
194       P:00A2 060AA0  [4 -      384]            rep     #10
195       P:00A3 200022  [2 -      386]            asr     a
196       P:00A4 380200  [2 -      388]            move              #2,n0
197       P:00A5 218E00  [2 -      390]            move              a1,a
198       P:00A6 46E800  [4 -      394]            move              x:(r0+n0),y0
199       P:00A7 200053  [2 -      396]            eor     y0,a
200       P:00A8 218E00  [2 -      398]            move              a1,a
201       P:00A9 200003  [2 -      400]            tst     a
202       P:00AA 0AF0AA  [6 -      406]            jeq     L12
                 0000B7
203       P:00AC 44F400  [4 -      410]            move              #>65535,x0
                 00FFFF
204       P:00AE 56F400  [4 -      414]            move              #>65536,a
                 010000
205       P:00B0 205800  [2 -      416]            move              (r0)+
206       P:00B1 46D000  [2 -      418]            move              x:(r0)-,y0
207       P:00B2 200054  [2 -      420]            sub     y0,a
208       P:00B3 200046  [2 -      422]            and     x0,a
209       P:00B4 218E00  [2 -      424]            move              a1,a
210       P:00B5 0AF080  [6 -      430]            jmp     L13
                 0000B9
211                                      L12
212       P:00B7 205800  [2 -      432]            move              (r0)+
213       P:00B8 56D000  [2 -      434]            move              x:(r0)-,a
214                                      L13
215                                      ; **************************************************
216                                      ; }
217                                      ; **************************************************
218       P:00B9 205003  [2 -      436]            tst     a         (r0)-
219       P:00BA 205000  [2 -      438]            move              (r0)-
220       P:00BB 205600  [2 -      440]            move              (r6)-
221       P:00BC 47D600  [2 -      442]            move              x:(r6)-,y1
222       P:00BD 46D600  [2 -      444]            move              x:(r6)-,y0
223       P:00BE 45D600  [2 -      446]            move              x:(r6)-,x1
224       P:00BF 44D600  [2 -      448]            move              x:(r6)-,x0
225       P:00C0 57D600  [2 -      450]            move              x:(r6)-,b
226       P:00C1 51E600  [2 -      452]            move              x:(r6),b0
227       P:00C2 221600  [2 -      454]            move              r0,r6
228       P:00C3 60E000  [2 -      456]            move              x:(r0),r0
229       P:00C4 00000C  [4 -      460]            rts
230    
231    
232                                                endsec
233    
234                                      ; 
235    
3    Errors
0    Warnings
